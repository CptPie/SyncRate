{{define "song.html"}}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{.title}}</title>
    <link href="/static/css/style.css" rel="stylesheet" />
  </head>
  <body>
    <div class="container">
      {{template "header" .}}
      <main>
        <div class="song-detail-layout">
          <div class="song-info">
            <h2>{{.song.NameOriginal}}</h2>
            {{if .song.NameEnglish}}
            <h3 style="color: #666; margin-top: -10px">
              {{.song.NameEnglish}}
            </h3>
            {{end}} {{if .song.Artists}}
            <p>
              <strong>Artists:</strong>
              {{range $index, $songArtist := .song.Artists}} {{if $index}},
              {{end}}{{$songArtist.NameOriginal}} {{end}}
            </p>
            {{end}} {{if .song.Category}}
            <p>
              <strong>Category:</strong>
              <span class="category">{{.song.Category.Name}}</span>
            </p>
            {{end}} {{if .song.IsCover}}
            <p>
              <span class="category" style="background: #28a745"
                >Cover Version</span
              >
            </p>
            {{end}} {{if .song.SourceURL}}
            <p>
              <a
                href="{{.song.SourceURL}}"
                target="_blank"
                style="color: #007bff"
                >Listen on Source Platform</a
              >
            </p>
            {{end}}
          </div>

          <div class="song-sidebar">
            {{if .song.ThumbnailURL}}
            <img
              src="{{.song.ThumbnailURL}}"
              alt="{{.song.NameOriginal}}"
              class="song-image"
            />
            {{end}}

            <div class="rating-form">
              <h4>Rate this song</h4>
              <form action="/songs/{{.song.SongID}}/vote" method="POST">
                <select name="rating" required class="form-select">
                  <option value="" disabled selected hidden>
                    Select rating...
                  </option>
                  <option value="1">1 - Terrible</option>
                  <option value="2">2 - Poor</option>
                  <option value="3">3 - Below Average</option>
                  <option value="4">4 - Fair</option>
                  <option value="5">5 - Average</option>
                  <option value="6">6 - Above Average</option>
                  <option value="7">7 - Good</option>
                  <option value="8">8 - Very Good</option>
                  <option value="9">9 - Excellent</option>
                  <option value="10">10 - Perfect</option>
                </select>
                <textarea
                  name="comment"
                  placeholder="Optional comment..."
                  class="form-textarea"
                ></textarea>
                <button type="submit" class="btn-secondary">
                  Submit Rating
                </button>
              </form>
            </div>
          </div>
        </div>

        {{if .votes}}
        <div class="votes-section">
          <h3>User Ratings</h3>
          {{range .votes}}
          <div class="vote-card">
            <div class="vote-header">
              <strong>{{.User.Username}}</strong>
              <span class="vote-rating">{{.Rating}}/10</span>
            </div>
            {{if .Comment}}
            <p class="vote-comment">{{.Comment}}</p>
            {{end}}
          </div>
          {{end}}
        </div>
        {{else}}
        <p style="margin-top: 40px; color: #666">
          No ratings yet. Be the first to rate this song!
        </p>
        {{end}}
      </main>
    </div>
    <script src="/static/js/theme-toggle.js"></script>
  </body>
</html>
{{end}}
